#
# Start at "2022-W42-Oct21-1241-49-CEST"
#
# Version information:
# European Spallation Source ERIC : iocsh (4.0.0-PID-22582)
#
# --->--> snip -->--> 
# Please Use Version and other environment variables
# in order to report or debug this shell
#
# HOSTDISPLAY=""
# WINDOWID="27263880"
# PWD="/home/anderssandstrom/source/ecmc_target_muts_logger/iocsh"
# USER="anderssandstrom"
# LOGNAME="anderssandstrom"
# EPICS_HOST_ARCH="linux-x86_64"
# EPICS_BASE="/epics/base-7.0.6.1"
# E3_REQUIRE_NAME="require"
# E3_REQUIRE_VERSION="4.0.0"
# E3_REQUIRE_LOCATION="/epics/base-7.0.6.1/require/4.0.0"
# E3_REQUIRE_BIN="/epics/base-7.0.6.1/require/4.0.0/bin"
# E3_REQUIRE_DB="/epics/base-7.0.6.1/require/4.0.0/db"
# E3_REQUIRE_DBD="/epics/base-7.0.6.1/require/4.0.0/dbd"
# E3_REQUIRE_INC="/epics/base-7.0.6.1/require/4.0.0/include"
# E3_REQUIRE_LIB="/epics/base-7.0.6.1/require/4.0.0/lib"
# EPICS_DRIVER_PATH="/epics/base-7.0.6.1/require/4.0.0/siteMods"
# EPICS_CA_AUTO_ADDR_LIST=""
# EPICS_CA_ADDR_LIST=""
# EPICS_PVA_AUTO_ADDR_LIST=""
# EPICS_PVA_ADDR_LIST=""
# PATH="/epics/base-7.0.6.1/require/4.0.0/bin:/epics/base-7.0.6.1/bin/linux-x86_64:/opt/conda/condabin:/usr/local/bin:/usr/local/sbin:/usr/bin:/usr/sbin:/bin:/sbin:/home/anderssandstrom/.local/bin:/home/anderssandstrom/bin"
# --->--> snip -->--> 
#
# Set REQUIRE_IOC for its internal PVs
epicsEnvSet REQUIRE_IOC "REQMOD:mcag-trgt-muts--22582"
#
# Enable an exit subroutine for sotfioc
dbLoadRecords "/epics/base-7.0.6.1/db/softIocExit.db" "IOC=REQMOD:mcag-trgt-muts--22582"
#
# Set E3_IOCSH_TOP for the absolute path where iocsh is executed.
epicsEnvSet E3_IOCSH_TOP "/home/anderssandstrom/source/ecmc_target_muts_logger/iocsh"
#
# 
# Load require module, which has the version 4.0.0
# 
dlload /epics/base-7.0.6.1/require/4.0.0/lib/linux-x86_64/librequire.so
dbLoadDatabase /epics/base-7.0.6.1/require/4.0.0/dbd/require.dbd
require_registerRecordDeviceDriver
Loading module info records for require
# 
# Set E3_CMD_TOP for the absolute path where start_ioc_xyz.script exists
epicsEnvSet E3_CMD_TOP "/home/anderssandstrom/source/ecmc_target_muts_logger/iocsh"
#
iocshLoad 'start_ioc_xyz.script',''
##############################################################################
## Startscript for measuring accuracy of steppers
## All sensors in  normal MUTS logger and 2 additional micro-epsilon ILD2300 sensors
##
## Author: Anders Sandstr√∂m, anders.sandstrom@ess.eu
##
##############################################################################
## Initiation:
epicsEnvSet("IOC" ,"IOC_TEST")
epicsEnvSet("ECMCCFG_INIT" ,"")  #Only run startup once (auto at PSI, need call at ESS), variable set to "#" in startup.cmd
epicsEnvSet("SCRIPTEXEC" ,"iocshLoad")
require ecmccfg 8.0.0
Module ecmccfg version 8.0.0+0 found in /epics/base-7.0.6.1/require/4.0.0/siteMods/ecmccfg/8.0.0+0/
Loading library /epics/base-7.0.6.1/require/4.0.0/siteMods/ecmccfg/8.0.0+0/lib/linux-x86_64/libecmccfg.so
Loaded ecmccfg version 8.0.0+0
Loading dbd file /epics/base-7.0.6.1/require/4.0.0/siteMods/ecmccfg/8.0.0+0/dbd/ecmccfg.dbd
Calling function ecmccfg_registerRecordDeviceDriver
Loading module info records for ecmccfg
# run module startup.cmd (only needed at ESS  PSI auto call at require)
iocshLoad /epics/base-7.0.6.1/require/4.0.0/siteMods/ecmccfg/8.0.0+0/startup.cmd, "IOC=IOC_TEST,ECMC_VER=8.0.0,EC_RATE=1000"
#==============================================================================
# startup.cmd
on error halt
require ecmc        "8.0.0"
Module ecmc version 8.0.0+0 found in /epics/base-7.0.6.1/require/4.0.0/siteMods/ecmc/8.0.0+0/
Module ecmc depends on asyn 4.42.0+0
Module asyn version 4.42.0+0 found in /epics/base-7.0.6.1/require/4.0.0/siteMods/asyn/4.42.0+0/
Loading library /epics/base-7.0.6.1/require/4.0.0/siteMods/asyn/4.42.0+0/lib/linux-x86_64/libasyn.so
Loaded asyn version 4.42.0+0
Loading dbd file /epics/base-7.0.6.1/require/4.0.0/siteMods/asyn/4.42.0+0/dbd/asyn.dbd
Calling function asyn_registerRecordDeviceDriver
Loading module info records for asyn
Module ecmc depends on exprtk 1.2.1+0
Module exprtk version 1.2.1+0 found in /epics/base-7.0.6.1/require/4.0.0/siteMods/exprtk/1.2.1+0/
Loading library /epics/base-7.0.6.1/require/4.0.0/siteMods/exprtk/1.2.1+0/lib/linux-x86_64/libexprtk.so
Loaded exprtk version 1.2.1+0
exprtk has no dbd file
Loading module info records for exprtk
Module ecmc depends on motor 7.0.7+0
Module motor version 7.0.7+0 found in /epics/base-7.0.6.1/require/4.0.0/siteMods/motor/7.0.7+0/
Module motor depends on asyn 4.42.0+0
Module asyn version 4.42.0+0 already loaded
Loading library /epics/base-7.0.6.1/require/4.0.0/siteMods/motor/7.0.7+0/lib/linux-x86_64/libmotor.so
Loaded motor version 7.0.7+0
Loading dbd file /epics/base-7.0.6.1/require/4.0.0/siteMods/motor/7.0.7+0/dbd/motor.dbd
Calling function motor_registerRecordDeviceDriver
Loading module info records for motor
Module ecmc depends on ruckig 1.0.0+0
Module ruckig version 1.0.0+0 found in /epics/base-7.0.6.1/require/4.0.0/siteMods/ruckig/1.0.0+0/
Loading library /epics/base-7.0.6.1/require/4.0.0/siteMods/ruckig/1.0.0+0/lib/linux-x86_64/libruckig.so
Loaded ruckig version 1.0.0+0
ruckig has no dbd file
Loading module info records for ruckig
Loading library /epics/base-7.0.6.1/require/4.0.0/siteMods/ecmc/8.0.0+0/lib/linux-x86_64/libecmc.so
Loaded ecmc version 8.0.0+0
Loading dbd file /epics/base-7.0.6.1/require/4.0.0/siteMods/ecmc/8.0.0+0/dbd/ecmc.dbd
Calling function ecmc_registerRecordDeviceDriver
Loading module info records for ecmc
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "'ecmcMotorRecord'='EthercatMC'", "require  EthercatMC 3.0.2 # Using EthercatMC motor record support.","# Using ecmcMotorRecord motor record support.")
# Using ecmcMotorRecord motor record support.
epicsEnvUnset(ECMC_EXE_CMD)
epicsEnvSet("ECMC_CONFIG_ROOT",     "/epics/base-7.0.6.1/require/4.0.0/siteMods/ecmccfg/8.0.0+0/")
epicsEnvSet("ECMC_CONFIG_DB",       "/epics/base-7.0.6.1/require/4.0.0/siteMods/ecmccfg/8.0.0+0/db/")
epicsEnvSet("SCRIPTEXEC",           "iocshLoad")
epicsEnvSet("SM_PREFIX",            "IOC_TEST:")    # colon added since IOC is _not_ PREFIX
epicsEnvSet("ECMC_PROC_HOOK",       "")
epicsEnvSet(ECMC_MODE, FULL)
ecmcEpicsEnvSetCalcTernary(ECMC_SUPPORT_MOTION, "'FULL'!='DAQ'","","# MODE == DAQ, DISABLING MOTION.")
epicsEnvShow(ECMC_SUPPORT_MOTION)
ECMC_SUPPORT_MOTION=
ecmcEpicsEnvSetCalcTernary(ECMC_USE_MOTOR_RECORD, "'FULL'=='FULL'","","# MODE != FULL, DISABLING MOTOR RECORD.")
epicsEnvShow(ECMC_USE_MOTOR_RECORD)
ECMC_USE_MOTOR_RECORD=
ecmcFileExist("/epics/base-7.0.6.1/require/4.0.0/siteMods/ecmccfg/8.0.0+0/initAll.cmd",1)
iocshLoad "/epics/base-7.0.6.1/require/4.0.0/siteMods/ecmccfg/8.0.0+0/initAll.cmd"
#==============================================================================
# initAll.cmd
ecmcFileExist("/epics/base-7.0.6.1/require/4.0.0/siteMods/ecmccfg/8.0.0+0/init.cmd",1)
iocshLoad /epics/base-7.0.6.1/require/4.0.0/siteMods/ecmccfg/8.0.0+0/init.cmd
#==============================================================================
# init.cmd
epicsEnvSet("ECMC_ASYN_TIMEOUT",      1)                   # Asyn timeout
epicsEnvSet("ECMC_ASYN_ADDR",         0)                   # Asyn Address
epicsEnvSet("ECMC_MOTOR_PORT",        "NOT SET")
epicsEnvSet("ECMC_ASYN_PORT",         "NOT SET")
epicsEnvSet("ECMC_PREFIX",            "NOT SET")
epicsEnvSet("ECMC_GEN_EC_RECORDS",    "NOT SET")
epicsEnvSet("ECMC_GEN_AX_RECORDS",    "NOT SET")
epicsEnvSet("ECMC_EC_AXIS_HEALTH",    "NOT SET")
epicsEnvSet("ECMC_PLC_SAMPLE_RATE_MS", "NOT SET")
epicsEnvSet("ECMC_TSE",               -2)
ecmcFileExist("/epics/base-7.0.6.1/require/4.0.0/siteMods/ecmccfg/8.0.0+0/initAxis.cmd",1)
iocshLoad "/epics/base-7.0.6.1/require/4.0.0/siteMods/ecmccfg/8.0.0+0/initAxis.cmd"
#==============================================================================
# initAxis.cmd
ecmcFileExist("/epics/base-7.0.6.1/require/4.0.0/siteMods/ecmccfg/8.0.0+0/ecmc_axis_unset.cmd",1)
iocshLoad "/epics/base-7.0.6.1/require/4.0.0/siteMods/ecmccfg/8.0.0+0/ecmc_axis_unset.cmd"
#==============================================================================
# ecmc_axis_unset.cmd
epicsEnvUnset(ECMC_AXISCONFIG)
epicsEnvUnset(ECMC_AXISFIELDINIT)
epicsEnvUnset(ECMC_PREC)
epicsEnvUnset(ECMC_EGU)
epicsEnvUnset(ECMC_DESC)
epicsEnvUnset(ECMC_R)
epicsEnvUnset(ECMC_MOTOR_NAME)
epicsEnvUnset(ECMC_EC_AXIS_HEALTH)
epicsEnvUnset(ECMC_MOD_RANGE)
epicsEnvUnset(ECMC_MOD_TYPE)
epicsEnvUnset(ECMC_EMERG_DECEL)
epicsEnvUnset(ECMC_VELO)
epicsEnvUnset(ECMC_ACCL)
epicsEnvUnset(ECMC_ACCS_EGU_PER_S2)
epicsEnvUnset(ECMC_HOME_VEL_TO)
epicsEnvUnset(ECMC_HOME_VEL_FRM)
epicsEnvUnset(ECMC_CNTRL_KP)
epicsEnvUnset(ECMC_CNTRL_KI)
epicsEnvUnset(ECMC_CNTRL_KD)
epicsEnvUnset(ECMC_CNTRL_KFF)
epicsEnvUnset(ECMC_EC_ENC_ACTPOS)
epicsEnvUnset(ECMC_EC_ENC_LATCHPOS)
epicsEnvUnset(ECMC_EC_ENC_LATCH_CONTROL)
epicsEnvUnset(ECMC_EC_ENC_LATCH_STATUS)
epicsEnvUnset(ECMC_HOME_LATCH_COUNT_OFFSET)
epicsEnvUnset(ECMC_ENC_SCALE_DENOM)
epicsEnvUnset(ECMC_ENC_SCALE_NUM)
epicsEnvUnset(ECMC_ENC_TYPE)
epicsEnvUnset(ECMC_ENC_BITS)
epicsEnvUnset(ECMC_ENC_ABS_BITS)
epicsEnvUnset(ECMC_ENC_ABS_OFFSET)
epicsEnvUnset(ECMC_ENC_VEL_FILTER_SIZE)
epicsEnvUnset(ECMC_ENC_POS_FILTER_SIZE)
epicsEnvUnset(ECMC_ENC_POS_FILTER_ENABLE)
epicsEnvUnset(ECMC_EC_ENC_RESET)
epicsEnvUnset(ECMC_EC_ENC_ALARM_0)
epicsEnvUnset(ECMC_EC_ENC_ALARM_1)
epicsEnvUnset(ECMC_EC_ENC_ALARM_2)
epicsEnvUnset(ECMC_EC_ENC_WARNING)
epicsEnvUnset(ECMC_EC_DRV_CONTROL)
epicsEnvUnset(ECMC_EC_DRV_STATUS)
epicsEnvUnset(ECMC_EC_DRV_VELOCITY)
epicsEnvUnset(ECMC_EC_DRV_BRAKE)
epicsEnvUnset(ECMC_EC_DRV_REDUCE_TORQUE)
epicsEnvUnset(ECMC_EC_DRV_RESET)
epicsEnvUnset(ECMC_EC_DRV_ALARM_0)
epicsEnvUnset(ECMC_EC_DRV_ALARM_1)
epicsEnvUnset(ECMC_EC_DRV_ALARM_2)
epicsEnvUnset(ECMC_EC_DRV_WARNING)
epicsEnvUnset(ECMC_DRV_SCALE_DENOM)
epicsEnvUnset(ECMC_DRV_SCALE_NUM)
epicsEnvUnset(ECMC_DRV_BRAKE_OPEN_DLY_TIME)
epicsEnvUnset(ECMC_DRV_BRAKE_CLOSE_AHEAD_TIME)
epicsEnvUnset(ECMC_SOFT_LOW_LIM)
epicsEnvUnset(ECMC_DXLM_ENABLE)
epicsEnvUnset(ECMC_SOFT_HIGH_LIM)
epicsEnvUnset(ECMC_DXLM_ENABLE)
epicsEnvUnset(ECMC_EC_MON_LOWLIM)
epicsEnvUnset(ECMC_EC_MON_HIGHLIM)
epicsEnvUnset(ECMC_EC_MON_HOME_SWITCH)
epicsEnvUnset(ECMC_EC_MON_EXT_INTERLOCK)
epicsEnvUnset(ECMC_MON_AT_TARGET_TOL)
epicsEnvUnset(ECMC_MON_AT_TARGET_TIME)
epicsEnvUnset(ECMC_MON_AT_TARGET_ENA)
epicsEnvUnset(ECMC_MON_LAG_MON_TOL)
epicsEnvUnset(ECMC_MON_LAG_MON_TIME)
epicsEnvUnset(ECMC_MON_LAG_MON_ENA)
epicsEnvUnset(ECMC_MON_VELO_MAX)
epicsEnvUnset(ECMC_MON_VELO_MAX_ENA)
epicsEnvUnset(ECMC_MON_VELO_MAX_DRV_TIME)
epicsEnvUnset(ECMC_MON_VELO_MAX_TRAJ_TIME)
epicsEnvUnset(ECMC_JOG_VEL)
epicsEnvUnset(ECMC_JAR)
epicsEnvUnset(ECMC_HOME_PROC)
epicsEnvUnset(ECMC_HOME_POS)
epicsEnvUnset(ECMC_HOME_ACC)
epicsEnvUnset(ECMC_HOME_DEC)
epicsEnvUnset(ECMC_DRV_TYPE)
epicsEnvUnset(ECMC_VELO)
epicsEnvUnset(ECMC_SOFT_LOW_LIM)
epicsEnvUnset(ECMC_SOFT_HIGH_LIM)
epicsEnvUnset(ECMC_HOME_POS_MOVE_ENA)
epicsEnvUnset(ECMC_HOME_POS_MOVE_TARG_POS)
epicsEnvUnset(ECMC_TRAJ_TYPE)
epicsEnvUnset(ECMC_JERK)
ecmcFileExist("/epics/base-7.0.6.1/require/4.0.0/siteMods/ecmccfg/8.0.0+0/ecmc_axis_sync_unset.cmd",1)
iocshLoad "/epics/base-7.0.6.1/require/4.0.0/siteMods/ecmccfg/8.0.0+0/ecmc_axis_sync_unset.cmd"
#==============================================================================
# ecmc_axis_sync_unset.cmd
epicsEnvUnset(ECMC_CMD_FRM_OTHER_PLC_ENABLE)
epicsEnvUnset(ECMC_CMD_AXIS_PLC_ENABLE)
epicsEnvUnset(ECMC_AXIS_EXPR_LINE_1)
epicsEnvUnset(ECMC_AXIS_EXPR_LINE_2)
epicsEnvUnset(ECMC_AXIS_EXPR_LINE_3)
epicsEnvUnset(ECMC_AXIS_EXPR_LINE_4)
epicsEnvUnset(ECMC_AXIS_EXPR_LINE_5)
epicsEnvUnset(ECMC_AXIS_EXPR_LINE_6)
epicsEnvUnset(ECMC_AXIS_EXPR_LINE_7)
epicsEnvUnset(ECMC_AXIS_EXPR_LINE_8)
epicsEnvUnset(ECMC_AXIS_EXPR_LINE_9)
epicsEnvUnset(ECMC_AXIS_EXPR_LINE_10)
epicsEnvUnset(ECMC_ENC_VELO_FILT_SIZE)
epicsEnvUnset(ECMC_ENC_VELO_FILT_ENABLE)
epicsEnvUnset(ECMC_ENC_SOURCE)
epicsEnvUnset(ECMC_TRAJ_VELO_FILT_SIZE)
epicsEnvUnset(ECMC_TRAJ_VELO_FILT_ENABLE)
epicsEnvUnset(ECMC_TRAJ_SOURCE)
epicsEnvSet("ECMC_EGU",               "mm")
epicsEnvSet("ECMC_PREC",              3)
epicsEnvSet("ECMC_AXISFIELDINIT",     "")                  # Extra field init to motor record
epicsEnvSet("ECMC_AXISCONFIG",        "")                  # Extra parameters to driver
####################################2022/10/21 12:41:50.412 
ECMC Initializes.............
2022/10/21 12:41:50.413 ESS Open Source EtherCAT Motion Control Epics Module2022/10/21 12:41:50.413 
Mode: Configuration
2022/10/21 12:41:50.413 OK
2022/10/21 12:41:50.413 OK
2022/10/21 12:41:50.415 OK
2022/10/21 12:41:50.422 OK
2022/10/21 12:41:50.447 OK
2022/10/21 12:41:50.447 OK
2022/10/21 12:41:50.447 OK
########################
############# ASYN Configuration:
epicsEnvSet("ECMC_MOTOR_PORT"     "MCU1")
epicsEnvSet("ECMC_ASYN_PORT"      "MC_CPU1")
epicsEnvSet("ECMC_PREFIX"         "IOC_TEST:")
ecmcAsynPortDriverConfigure(MC_CPU1,1000,0,0,100)
ecmcAsynPortDriverConfigure: portName = MC_CPU1, paramTableSize = 1000, disableAutoConnect = 0, priority = 0, defaultSampleRateMS = 100.000000
asynOctetSetOutputEos(MC_CPU1, -1, ";\n")
asynOctetSetInputEos(MC_CPU1, -1, ";\n")
asynSetTraceMask(MC_CPU1, -1, 0x41)
asynSetTraceIOMask(MC_CPU1, -1, 6)
asynSetTraceInfoMask(MC_CPU1, -1, 1)
ecmcMotorRecordCreateController(MCU1, MC_CPU1, "64", 200, 1000, "")
############################################################
############# Misc settings:
# Disable function call trace printouts
ecmcConfigOrDie "Cfg.SetEnableFuncCallDiag(0)"
# Disable on change printouts from objects (enable for easy logging)
ecmcConfigOrDie "Cfg.SetTraceMaskBit(15,0)"
# Choose to generate EPICS-records for EtherCAT-entries
# (For records use ECMC_GEN_EC_RECORDS="-records" otherwise ECMC_GEN_EC_RECORDS="")
epicsEnvSet("ECMC_GEN_EC_RECORDS",          "-records")
# Choose to generate EPICS-records for ax-entries (PosAct, SetPos,..)
# (For records use ECMC_GEN_AX_RECORDS="-records" otherwise ECMC_GEN_AX_RECORDS="")
epicsEnvSet("ECMC_GEN_AX_RECORDS",          "-records")
# suffix for pva enabled scripts, templates and substitutions
ecmcEpicsEnvSetCalcTernary(ECMC_PVA, "0", "Pva","")
# Set EtherCAT frequency (defaults to 1000)
ecmcConfigOrDie "Cfg.SetSampleRate(1000)"
epicsEnvSet("ECMC_EC_SAMPLE_RATE" ,   1000)
ecmcEpicsEnvSetCalc("ECMC_EC_SAMPLE_RATE_MS" ,1000/1000)
# Update records in 10ms (100Hz) for FULL MODE and in EC_RATE for DAQ mode
ecmcEpicsEnvSetCalcTernary(ECMC_SAMPLE_RATE_MS, "'FULL'=='DAQ'","1","10")
epicsEnvSet("ECMC_P_SCRIPT",        "mXsXXX")
ecmcEpicsEnvSetCalcTernary(ECMC_MASTER_CMD, "0>=0", "","#- ")
 ecmcFileExist("/epics/base-7.0.6.1/require/4.0.0/siteMods/ecmccfg/8.0.0+0/addMaster.cmd",1)
 iocshLoad "/epics/base-7.0.6.1/require/4.0.0/siteMods/ecmccfg/8.0.0+0/addMaster.cmd", "MASTER_ID=0"
#===============================================================================
# addMaster.cfg
epicsEnvSet("ECMC_EC_MASTER_ID"          "0")
# Claim master
ecmcConfigOrDie "Cfg.EcSetMaster(0)"
epicsEnvSet("ECMC_EC_MASTER_ID" ,0)
epicsEnvSet("ECMC_TMP_DIR",         "/tmp/IOC_TEST/EcMaster_0/")
system "mkdir -p /tmp/IOC_TEST/EcMaster_0/"
epicsEnvSet("ECMC_TMP_DIR",         "/tmp/IOC_TEST/EcMaster_0/")
system "mkdir -p /tmp/IOC_TEST/EcMaster_0/"
ecmcFileExist("/epics/base-7.0.6.1/require/4.0.0/siteMods/ecmccfg/8.0.0+0/setDiagnostics.cmd",1)
iocshLoad /epics/base-7.0.6.1/require/4.0.0/siteMods/ecmccfg/8.0.0+0/setDiagnostics.cmd
#==============================================================================
# setDiagnostics.cmd
ecmcConfigOrDie "Cfg.EcSetDiagnostics(1)"
ecmcConfigOrDie "Cfg.EcEnablePrintouts(0)"
ecmcConfigOrDie "Cfg.EcSetDomainFailedCyclesLimit(100)"
epicsEnvSet("ECMCCFG_INIT" ,"#")
##############################################################################
## Load breaktables with calibration data for Telemess sensors.
require iocshutils 2.10.0  # For updateMenuConvert()
Module iocshutils version 2.10.0+0 found in /epics/base-7.0.6.1/require/4.0.0/siteMods/iocshutils/2.10.0+0/
Loading library /epics/base-7.0.6.1/require/4.0.0/siteMods/iocshutils/2.10.0+0/lib/linux-x86_64/libiocshutils.so
Loaded iocshutils version 2.10.0+0
Loading dbd file /epics/base-7.0.6.1/require/4.0.0/siteMods/iocshutils/2.10.0+0/dbd/iocshutils.dbd
Calling function iocshutils_registerRecordDeviceDriver
Loading module info records for iocshutils
dbLoadRecords ../src/bptTypeTelemessCalib_stainless.dbd
updateMenuConvert
Adding breakpoint table "typeTelemess32900_21875" to menuConvert.
Adding breakpoint table "typeTelemess33018_21876" to menuConvert.
Adding breakpoint table "typeTelemess33020_21877" to menuConvert.
Adding breakpoint table "typeTelemess33021_21878" to menuConvert.
dbDumpBreaktable
breaktable(typeTelemess32900_21875) {
	raw=-2594.030000 slope=4.748920e-04 eng=0.000000
	r 0  0:0   PREOP  +  EK1100 EtherCAT Coupler (2A E-Bus)
 1  0:1   PREOP  +  EK1110 EtherCAT-Verl‰ngerung
 2  0:2   PREOP  +  ILD2300
 3  0:3   PREOP  +  EK1100 EtherCAT-Koppler (2A E-Bus)
 4  0:4   PREOP  +  EL5021 1Ch. Sin/Cos Encoder
 5  0:5   PREOP  +  EL3174-0002 4K. Ana. Eingang  +/-10V, +/-20mA, 16 Bit, Galvanis
 6  0:6   PREOP  +  EL4122 2K. Ana. Ausgang 4-20mA, 16bit
 7  0:7   PREOP  +  EL9505 Netzteilklemme 5V
 8  0:8   PREOP  +  EL1252-0050 2K. Fast Dig. Eingang 5V, 1µs, DC Latch
 9  0:9   PREOP  +  EL9410 E-Bus Netzteilklemme (Diagnose)
10  0:10  PREOP  +  EL2004 4K. Dig. Ausgang 24V, 0.5A
2022/10/21 12:41:50.505 OK
aw=1617.454000 slope=4.783584e-04 eng=2.000000
	raw=5798.420000 slope=5.904063e-04 eng=4.000000
	raw=9185.918000 slope=6.488623e-04 eng=6.000000
	raw=12268.236000 slope=6.687254e-04 eng=8.000000
	raw=15259.000000 slope=6.425009e-04 eng=10.000000
	raw=18371.836000 slope=7.201659e-04 eng=12.000000
	raw=21148.974000 slope=1.149738e-03 eng=14.000000
	raw=22888.500000 slope=1.985912e-03 eng=16.000000
	raw=23895.594000 slope=2.978868e-03 eng=18.000000
	raw=24566.990000 slope=2.978868e-03 eng=20.000000
}
breaktable(typeTelemess33018_21876) {
	raw=-2899.210000 slope=4.062093e-04 eng=0.000000
	raw=793.468000 slope=3.536066e-04 eng=1.500000
	raw=5035.470000 slope=3.870183e-04 eng=3.000000
	raw=8911.256000 slope=4.468302e-04 eng=4.500000
	raw=12268.236000 slope=5.015441e-04 eng=6.000000
	raw=15259.000000 slope=5.228864e-04 eng=7.500000
	raw=18127.692000 slope=7.447170e-04 eng=9.000000
	raw=20141.880000 slope=1.068507e-03 eng=10.500000
	raw=21545.708000 slope=1.489434e-03 eng=12.000000
	raw=22552.802000 slope=2.340539e-03 eng=13.500000
	raw=23193.680000 slope=2.340539e-03 eng=15.000000
}
breaktable(typeTelemess33020_21877) {
	raw=-2807.656000 slope=3.810180e-04 eng=0.000000
	raw=1129.166000 slope=3.561690e-04 eng=1.500000
	raw=5340.650000 slope=3.996042e-04 eng=3.000000
	raw=9094.364000 slope=4.636917e-04 eng=4.500000
	raw=12329.272000 slope=5.119929e-04 eng=6.000000
	raw=15259.000000 slope=5.461258e-04 eng=7.500000
	raw=18005.620000 slope=8.191887e-04 eng=9.000000
	raw=19836.700000 slope=9.637514e-04 eng=10.500000
	raw=21393.118000 slope=2.047972e-03 eng=12.000000
	raw=22125.550000 slope=2.586912e-03 eng=13.500000
	raw=22705.392000 slope=2.586912e-03 eng=15.000000
}
breaktable(typeTelemess33021_21878) {
	raw=-2868.692000 slope=4.028797e-04 eng=0.000000
	raw=854.504000 slope=3.461361e-04 eng=1.500000
	raw=5188.060000 slope=4.028797e-04 eng=3.000000
	raw=8911.256000 slope=4.388511e-04 eng=4.500000
	raw=12329.272000 slope=5.015441e-04 eng=6.000000
	raw=15320.036000 slope=5.401244e-04 eng=7.500000
	raw=18097.174000 slope=7.123380e-04 eng=9.000000
	raw=20202.916000 slope=1.092252e-03 eng=10.500000
	raw=21576.226000 slope=1.535979e-03 eng=12.000000
	raw=22552.802000 slope=2.234151e-03 eng=13.500000
	raw=23224.198000 slope=2.234151e-03 eng=15.000000
}
##############################################################################
## Configure hardware:
system "ethercat slaves"
# 0  0:0   OP     +  EK1100 EtherCAT Coupler (2A E-Bus)
# 1  0:1   PREOP  +  EK1110 EtherCAT-VerlÔøΩngerung
# 2  0:2   PREOP  +  ILD2300
# 3  0:3   PREOP  +  EK1100 EtherCAT-Koppler (2A E-Bus)
# 4  0:4   PREOP  +  EL5021 1Ch. Sin/Cos Encoder
# 5  0:5   PREOP  +  EL3174-0002 4K. Ana. Eingang  +/-10V, +/-20mA, 16 Bit, Galvanis
# 6  0:6   PREOP  +  EL4122 2K. Ana. Ausgang 4-20mA, 16bit
# 7  0:7   PREOP  +  EL9505 Netzteilklemme 5V
# 8  0:8   PREOP  +  EL1252-0050 2K. Fast Dig. Eingang 5V, 1ÔøΩs, DC Latch
# 9  0:9   PREOP  +  EL9410 E-Bus Netzteilklemme (Diagnose)
#10  0:10  PREOP  +  EL2004 4K. Dig. Ausgang 24V, 0.5A
#11  0:11  PREOP  +  ILD2300
epicsEnvSet("ECMC_SAMPLE_RATE_MS", 100)
epicsEnvSet("ECMC_EC_SLAVE_NUM",              "0")
iocshLoad /epics/base-7.0.6.1/require/4.0.0/siteMods/ecmccfg/8.0.0+0/addSlave.cmd, "SLAVE_ID=0, HW_DESC=EK1100"
#==============================================================================
# addSlave.cmd
epicsEnvSet("ECMC_EC_SLAVE_NUM",  "0")
epicsEnvSet("HW_DESC",            "EK1100")
epicsEnvSet("P_SCRIPT",           "mXsXXX")
# add ${HW_DESC} to the bus at position ${SLAVE_ID}
ecmcFileExist("/epics/base-7.0.6.1/require/4.0.0/siteMods/ecmccfg/8.0.0+0/ecmcEK1100.cmd",1)
iocshLoad "/epics/base-7.0.6.1/require/4.0.0/siteMods/ecmccfg/8.0.0+0/ecmcEK1100.cmd" "NELM=1"
epicsEnvSet("ECMC_EC_HWTYPE"             "EK1100")
epicsEnvSet("ECMC_EC_VENDOR_ID"          "0x2")
epicsEnvSet("ECMC_EC_PRODUCT_ID"         "0x044c2c52")
iocshLoad /epics/base-7.0.6.1/require/4.0.0/siteMods/ecmccfg/8.0.0+0/slaveVerify.cmd
ecmcEpicsEnvSetCalcTernary(SLAVE_VERIFY, "0==0","","#- ")
ecmcConfigOrDie "Cfg.EcSlaveVerify(0,0,0x2,0x044c2c52)"
ecmcEpicsEnvSetCalcTernary2022/10/21 12:41:50.508 OK
2022/10/21 12:41:50.550 OK
2022/10/21 12:41:50.552 OK
(SLAVE_RESET, "0>0","","#- ")
epicsEnvSet(ECMC_EC_SLAVE_FW, "0x0000")
ecmcEpicsEnvSetCalcTernary(SLAVE_FW, "0>0","","#- ")
epicsEnvUnset(SLAVE_VERIFY)
epicsEnvUnset(SLAVE_RESET)
epicsEnvUnset(SLAVE_FW)
ecmcConfigOrDie "Cfg.EcAddSlave(0,0,0x2,0x044c2c52)"
# deduce what the prefix should be
ecmcFileExist("/epics/base-7.0.6.1/require/4.0.0/siteMods/ecmccfg/8.0.0+0/ecmcmXsXXX.cmd",1)
iocshLoad "/epics/base-7.0.6.1/require/4.0.0/siteMods/ecmccfg/8.0.0+0/ecmcmXsXXX.cmd" "MASTER_ID=0,SLAVE_POS=0,HWTYPE=EK1100"
#==============================================================================
# ecmcmXsXXX.cmd
ecmcEpicsEnvSetCalc("sid", "0","%03d")
ecmcEpicsEnvSetCalc("mid", "0","%01d")
epicsEnvSet("ECMC_G",            "IOC_TEST:m0s000")
epicsEnvSet("ECMC_P",            "IOC_TEST:m0s000-")
epicsEnvUnset(sid)
epicsEnvUnset(mid)
ecmcEpicsEnvSetCalcTernary(DEFAULT_SUBS, "True", "","#- ")
iocshLoad "/epics/base-7.0.6.1/require/4.0.0/siteMods/ecmccfg/8.0.0+0/applySubstitutions.cmd" "SUBST_FILE=ecmcEK1100.substitutions,ECMC_P=IOC_TEST:m0s000-"
#==============================================================================
# applySubstitutions.cmd
ecmcFileExist(ecmcEK1100.substitutions,1,1)
dbLoadTemplate(ecmcEK1100.substitutions,"ECMC_P=IOC_TEST:m0s000-,ECMC_G=IOC_TEST:m0s000,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,MASTER_ID=0,SLAVE_POS=0,HWTYPE=EK1100,T_SMP_MS=100,TSE=-2,NELM=1")
epicsEnvUnset(DEFAULT_SUBS)
ecmcEpicsEnvSetCalcTernary(DEFAULT_SLAVE_PVS, "True", "","#- ")
iocshLoad "/epics/base-7.0.6.1/require/4.0.0/siteMods/ecmccfg/8.0.0+0/applyTemplate.cmd" "TEMPLATE_FILE=ecmcEcSlave.template,ECMC_P=IOC_TEST:m0s000-,ECMC_G=IOC_TEST:m0s000"
#==============================================================================
# applyTemplate.cmd
ecmcFileExist(ecmcEcSlave.template,1,1)
dbLoadRecords("ecmcEcSlave.template", "ECMC_P=IOC_TEST:m0s000-,ECMC_G=IOC_TEST:m0s000,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,MASTER_ID=0,SLAVE_POS=0,HWTYPE=EK1100,T_SMP_MS=100,TSE=-2,")
epicsEnvUnset(DEFAULT_SLAVE_PVS)
# increment SLAVE_ID
ecmcEpicsEnvSetCalc("SLAVE_ID", "0+1","%d")
epicsEnvSet("ECMC_EC_SLAVE_NUM",              "1")
iocshLoad /epics/base-7.0.6.1/require/4.0.0/siteMods/ecmccfg/8.0.0+0/addSlave.cmd, "SLAVE_ID=1, HW_DESC=EK1110"
#==============================================================================
# addSlave.cmd
epicsEnvSet("ECMC_EC_SLAVE_NUM",  "1")
epicsEnvSet("HW_DESC",            "EK1110")
epicsEnvSet("P_SCRIPT",           "mXsXXX")
# add ${HW_DESC} to the bus at position ${SLAVE_ID}
ecmcFileExist("/epics/base-7.0.6.1/require/4.0.0/siteMods/ecmccfg/8.0.0+0/ecmcEK1110.cmd",1)
iocshLoad "/epics/base-7.0.6.1/require/4.0.0/siteMods/ecmccfg/8.0.0+0/ecmcEK1110.cmd" "NELM=1"
epicsEnvSet("ECMC_EC_HWTYPE"             "EK1110")
epicsEnvSet("ECMC_EC_VENDOR_ID"          "0x2")
epicsEnvSet("ECMC_EC_PRODUCT_ID"         "0x04562c52")
iocshLoad /epics/base-7.0.6.1/require/4.0.0/siteMods/ecmccfg/8.0.0+0/slaveVerify.cmd
ecmcEpicsEnvSetCalcTernary(SLAVE_VERIFY, "0==0","","#- ")
ecmcConfigOrDie "Cfg.EcSlaveVerify(0,1,0x2,0x04562c52)"
ecmcEpicsEnvSetCalcTernary(SLAVE_RESET, "0>0","","#- ")
epicsEnvSet(ECMC_EC_SLAVE_FW, "0x0000")
ecmcEpicsEnvSetCalcTernary(SLAVE_FW, "0>0","","#- ")
epicsEnvUnset(SLAVE_VERIFY)
epicsEnvUnset(SLAVE_RESET)
epicsEnvUnset(SLAVE_FW)
ecmcConfigOrDie "Cfg.EcAddSlave(0,1,0x2,0x04562c52)"
# deduce what the prefix should be
ecmcFileExist("/epics/base-7.0.6.1/require/4.0.0/siteMods/ecmccfg/8.0.0+0/ecmcmXsXXX.cmd",1)
iocshLoad "/epics/base-7.0.6.1/require/4.0.0/siteMods/ecmccfg/8.0.0+0/ecmcmXsXXX.cmd" "MASTER_ID=0,SLAVE_POS=1,HWTYPE=EK1110"
#==============================================================================
# ecmcmXsXXX.cmd
ecmcEpicsEnvSetCalc("sid", "1","%03d")
ecmcEpicsEnvSetCalc("mid", "0","%01d")
epicsEnvSet("ECMC_G",            "IOC_TEST:m0s001")
epicsEnvSet("ECMC_P",            "IOC_TEST:m0s001-")
epicsEnvUnset(sid)
epicsEnvUnset(mid)
ecmcEpicsEnvSetCalcTernary(DEFAULT_SUBS, "True", "","#- ")
iocshLoad "/epics/base-7.0.6.1/require/4.0.0/siteMods/ecmccfg/8.0.0+0/applySubstitutions.cmd" "SUBST_FILE=ecmcEK1110.substitutions,ECMC_P=IOC_TEST:m0s2022/10/21 12:41:50.572 ../devEcmcSup/ethercat/ecmcEc.cpp/verifySlave:1962: Error: Slave verification for busposition 2 failed. Product Code 0x3ede78 != 0x3ede74 (0x26026).
2022/10/21 12:41:50.572 ECMC command "Cfg.EcSlaveVerify(0,2,0x00000607,0x003ede78)" returned error: ERROR_EC_SLAVE_VERIFICATION_FAIL (0x26026)
001-"
#==============================================================================
# applySubstitutions.cmd
ecmcFileExist(ecmcEK1110.substitutions,1,1)
dbLoadTemplate(ecmcEK1110.substitutions,"ECMC_P=IOC_TEST:m0s001-,ECMC_G=IOC_TEST:m0s001,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,MASTER_ID=0,SLAVE_POS=1,HWTYPE=EK1110,T_SMP_MS=100,TSE=-2,NELM=1")
epicsEnvUnset(DEFAULT_SUBS)
ecmcEpicsEnvSetCalcTernary(DEFAULT_SLAVE_PVS, "True", "","#- ")
iocshLoad "/epics/base-7.0.6.1/require/4.0.0/siteMods/ecmccfg/8.0.0+0/applyTemplate.cmd" "TEMPLATE_FILE=ecmcEcSlave.template,ECMC_P=IOC_TEST:m0s001-,ECMC_G=IOC_TEST:m0s001"
#==============================================================================
# applyTemplate.cmd
ecmcFileExist(ecmcEcSlave.template,1,1)
dbLoadRecords("ecmcEcSlave.template", "ECMC_P=IOC_TEST:m0s001-,ECMC_G=IOC_TEST:m0s001,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,MASTER_ID=0,SLAVE_POS=1,HWTYPE=EK1110,T_SMP_MS=100,TSE=-2,")
epicsEnvUnset(DEFAULT_SLAVE_PVS)
# increment SLAVE_ID
ecmcEpicsEnvSetCalc("SLAVE_ID", "1+1","%d")
##Add optic sensor
epicsEnvSet("ECMC_SAMPLE_RATE_MS", 10)
epicsEnvSet("ECMC_EC_SLAVE_NUM",              "2")
iocshLoad /epics/base-7.0.6.1/require/4.0.0/siteMods/ecmccfg/8.0.0+0/addSlave.cmd, "SLAVE_ID=2, HW_DESC=OptoILD2300_100mm"
#==============================================================================
# addSlave.cmd
epicsEnvSet("ECMC_EC_SLAVE_NUM",  "2")
epicsEnvSet("HW_DESC",            "OptoILD2300_100mm")
epicsEnvSet("P_SCRIPT",           "mXsXXX")
# add ${HW_DESC} to the bus at position ${SLAVE_ID}
ecmcFileExist("/epics/base-7.0.6.1/require/4.0.0/siteMods/ecmccfg/8.0.0+0/ecmcOptoILD2300_100mm.cmd",1)
iocshLoad "/epics/base-7.0.6.1/require/4.0.0/siteMods/ecmccfg/8.0.0+0/ecmcOptoILD2300_100mm.cmd" "NELM=1"
epicsEnvSet("ECMC_EC_HWTYPE"             "OptoILD2300_100mm")
epicsEnvSet("ECMC_EC_VENDOR_ID"          "0x00000607")
epicsEnvSet("ECMC_EC_PRODUCT_ID"         "0x003ede78")
ecmcFileExist(/epics/base-7.0.6.1/require/4.0.0/siteMods/ecmccfg/8.0.0+0/slaveVerify.cmd,1)
iocshLoad /epics/base-7.0.6.1/require/4.0.0/siteMods/ecmccfg/8.0.0+0/slaveVerify.cmd
ecmcEpicsEnvSetCalcTernary(SLAVE_VERIFY, "0==0","","#- ")
ecmcConfigOrDie "Cfg.EcSlaveVerify(0,2,0x00000607,0x003ede78)"
